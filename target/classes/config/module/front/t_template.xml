<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><!-- create by autoCode,v1.0.0 --><mapper namespace="front.template">	<select id="front.template.selectPageList" parameterType="net.yozo.services.front.template.bean.Template" resultType="net.yozo.services.front.template.bean.Template">		select p.id,p.catalogID,p.name,p.price,p.nowPrice,p.author,p.isTop,p.isRecommend,p.description,p.downloadNum,p.shareNum,p.score,		p.collectNum,p.browseNum,p.imgUrl,p.shrinkUrl,p.fileUrl,p.videoUrl,p.showModel,p.status,p.createTime,p.updateTime,p.sellCount,p.publishTime	 from t_template p		LEFT JOIN t_template_recommend r ON p.id=r.template_id		where status =1	 <if test="id!=null and id!=''">		 	and p.id=#{id}	 </if>	<if test="catalogID!=null and catalogID!=''">		and catalogID=#{catalogID}	</if>		<if test="name!=null and name!=''">			and name like concat('%',#{name,jdbcType=VARCHAR},'%')		</if>	<if test="source != 0">		and source=#{source}	</if>	 <if test="isTop!=null and isTop!=''">	 	and isTop=#{isTop}	 </if>	 <if test="isRecommend!=null and isRecommend!=''">	 	and isRecommend=#{isRecommend}	 </if>	 <if test="startDate!=null and startDate!=''">		and createTime &gt;= #{startDate}	 </if>	 <if test="endDate!=null and endDate!=''">		and createTime &lt;= #{endDate}	 </if>		<if test='isFee=="y"'>			and  nowPrice=0 and score=0		</if>		<if test='isFee=="n"'>			and  (nowPrice>0 or isTop="y")		</if>		<if test="queryLabelIDs!=null and queryLabelIDs.size &gt; 0">			and p.id in ( select t_id from t_label_link			where l_id in			<foreach item="item" index="index" collection="queryLabelIDs" open="(" separator="," close=")">				#{item}			</foreach>			GROUP BY t_id HAVING COUNT(0)=#{queryLabelIDs.size}			)		</if>		<if test="orderBy==1">			order by browseNum desc		</if>		<if test="orderBy==2">			order by publishTime desc		</if>		<if test="orderBy==3">			order by downloadNum desc		</if>		<if test="orderBy==4">			order by IFNULL(r.sort,0) desc,p.updateTime desc		</if>		<if test=" orderBy==null or orderBy==''">			order by p.updateTime desc		</if> 	limit #{offset},#{pageSize}	</select>	<select id="front.template.selectPageCount" parameterType="net.yozo.services.front.template.bean.Template" resultType="java.lang.Integer">	 select count(*) from t_template p where status = 1		<if test="id!=null and id!=''">			and p.id=#{id}		</if>		<if test="catalogID!=null and catalogID!=''">			and catalogID=#{catalogID}		</if>		<if test="name!=null and name!=''">			and name like concat('%',#{name,jdbcType=VARCHAR},'%')		</if>		<if test="source != 0">		    and source=#{source}		</if>		<if test="isTop!=null and isTop!=''">			and isTop=#{isTop}		</if>		<if test="isRecommend!=null and isRecommend!=''">			and isRecommend=#{isRecommend}		</if>		<if test="startDate!=null and startDate!=''">			and createTime &gt;= #{startDate}		</if>		<if test="endDate!=null and endDate!=''">			and createTime &lt;= #{endDate}		</if>		<if test='isFee=="y"'>			and  nowPrice=0 and score=0		</if>		<if test='isFee=="n"'>			and  (nowPrice>0 or isTop="y")		</if>		<if test="queryLabelIDs!=null and queryLabelIDs.size &gt; 0">			and p.id in ( select t_id from t_label_link			where l_id in			<foreach item="item" index="index" collection="queryLabelIDs" open="(" separator="," close=")">				#{item}			</foreach>			GROUP BY t_id HAVING COUNT(0)=#{queryLabelIDs.size}			)		</if>	</select>	<select id="front.template.selectList" parameterType="net.yozo.services.front.template.bean.Template" resultType="net.yozo.services.front.template.bean.Template">		select *		from t_template t where status = 1		<if test="id!=null and id!=''">			and id=#{id}		</if>		<if test="catalogID!=null and catalogID!=''">			and catalogID=#{catalogID}		</if>		<if test="name!=null and name!=''">			and t.name like CONCAT('%','${name}','%' )		</if>		order by updateTime desc	</select>	<insert id="front.template.insert" parameterType="net.yozo.services.front.template.bean.Template" useGeneratedKeys="true" keyProperty="id">		insert into t_template		(		id,name,author,catalogID,createTime,updateTime,publishTime,sellCount,status,		price,nowPrice,fileUrl,showModel,isTop,isRecommend,source		<if test="imgUrl!=null and imgUrl!=''">			,imgUrl		</if>		<if test="shrinkUrl!=null and shrinkUrl!=''">			,shrinkUrl		</if>        <if test="videoUrl!=null and videoUrl!=''">            ,videoUrl        </if>		<if test="score!=0">			,score		</if>		<if test="description!=null and description!=''">			,description		</if>		)		values		(		id,#{name},#{author},#{catalogID},now(),now(),now(),#{sellCount},#{status},		#{price},#{nowPrice},#{fileUrl},#{showModel},#{isTop},#{isRecommend},#{source}		<if test="imgUrl!=null and imgUrl!=''">			,#{imgUrl}		</if>		<if test="shrinkUrl!=null and shrinkUrl!=''">			,#{shrinkUrl}		</if>        <if test="videoUrl!=null and videoUrl!=''">            ,#{videoUrl}        </if>		<if test="score!=0">			,#{score}		</if>		<if test="description!=null and description!=''">			,#{description}		</if>	)</insert>		<!-- 更新后台商品信息，若其他地方需要更新商品部分数据，请另外写方法，此方法仅仅用于更新商品全部数据（此方法不作为通用update方法调用，否则会导致部分字段的数据丢失，切记。） -->	<update id="front.template.update" parameterType="net.yozo.services.front.template.bean.Template">		update t_template        set updateTime=now()		<if test="isTop !=null and isTop!=''">			,isTop=#{isTop}		</if>		<if test="author!=null and author!=''">			,author=#{author}		</if>		<if test="catalogID!=null and catalogID!=''">			, catalogID=#{catalogID}		</if>		<if test="isRecommend !=null and isRecommend!=''">			,isRecommend=#{isRecommend}		</if>		<if test="status != null">			,status=#{status}		</if>		<if test="score != null">			,score=#{score}		</if>		<if test="downloadNum !=null and downloadNum!=''">			,downloadNum=#{downloadNum}		</if>		<if test="shareNum !=null and shareNum!=''">			,shareNum=#{shareNum}		</if>		<if test="collectNum !=null and collectNum!=''">			,collectNum=#{collectNum}		</if>		<if test="browseNum !=null and browseNum!=''">			,browseNum=#{browseNum}		</if>		<if test="name !=null and name !=''">			,name=#{name}		</if>		<if test="description !=null and description !=''">			,description=#{description}		</if>		<if test="price !=null and price !=''">			,price=#{price}		</if>		<if test="nowPrice !=null and nowPrice !=''">			,nowPrice=#{nowPrice}		</if>		<if test="imgUrl !=null and imgUrl !=''">			,imgUrl=#{imgUrl}		</if>		<if test="shrinkUrl !=null and shrinkUrl !=''">			,shrinkUrl=#{shrinkUrl}		</if>        <if test="videoUrl !=null and videoUrl !=''">            ,videoUrl=#{videoUrl}        </if>		<if test="fileUrl !=null and fileUrl !=''">			,fileUrl=#{fileUrl}		</if>		<if test="showModel !=0">			,showModel=#{showModel}		</if>		<if test="description!=null and description!=''">			,description=#{description}		</if>		 where id=#{id}	</update>		<select id="front.template.selectOne" parameterType="net.yozo.services.front.template.bean.Template" resultType="net.yozo.services.front.template.bean.Template">	 select * 	 from t_template t where status=1		 <if test="id!=null and id!=''">		 	and id=#{id}		 </if>		 <if test="catalogID!=null and catalogID!=''">		 	and catalogID=#{catalogID}		 </if>		 <if test="name!=null and name!=''">				and t.name like CONCAT('%','${name}','%' ) 		 </if>	</select>	<select id="front.template.queryTemplate" parameterType="net.yozo.services.front.template.bean.Template" resultType="net.yozo.services.front.template.bean.Template">		SELECT * FROM (		SELECT tt.*,GROUP_CONCAT(tl.NAME) AS labels,ttr.sort FROM t_template tt		LEFT JOIN t_label_link tll ON tt.id = tll.t_id		LEFT JOIN t_label tl ON tll.l_id = tl.id		LEFT JOIN t_template_recommend ttr ON ttr.template_id=tt.id		WHERE tt.STATUS=1		<if test='catalogID!=null and catalogID!=""'>			and tt.catalogID = #{catalogID}		</if>		<if test='isFee=="y"'>			and  tt.nowPrice=0  and tt.score=0		</if>		<if test='isFee=="n"'>			and  (tt.nowPrice>0 or tt.isTop="y")		</if>		GROUP BY id		)AS templates		WHERE templates.`name` LIKE  CONCAT('%','${name}','%' ) OR templates.labels LIKE  CONCAT('%','${name}','%' )		<if test="orderBy==1">			order by browseNum desc		</if>		<if test="orderBy==2">			order by publishTime desc		</if>		<if test="orderBy==3">			order by downloadNum desc		</if>		<if test="orderBy==4">			order by IFNULL(sort,0) desc,updateTime desc		</if>		<if test=" orderBy==null or orderBy==''">			order by updateTime desc		</if>		limit #{offset},#{pageSize}	</select>	<select id="front.template.queryTemplateCount" parameterType="net.yozo.services.front.template.bean.Template" resultType="java.lang.Integer">		SELECT count(*) FROM (		SELECT tt.id,tt.name,GROUP_CONCAT(tl.NAME) AS labels FROM t_template tt		LEFT JOIN t_label_link tll ON tt.id = tll.t_id		LEFT JOIN t_label tl ON tll.l_id = tl.id		WHERE tt.STATUS=1		<if test='catalogID!=null and catalogID!=""'>			and tt.catalogID = #{catalogID}		</if>		<if test='isFee=="y"'>			and  tt.nowPrice=0  and tt.score=0		</if>		<if test='isFee=="n"'>			and  (tt.nowPrice>0 or tt.isTop="y")		</if>		GROUP BY id		)AS templates		WHERE templates.`name` LIKE  CONCAT('%','${name}','%' ) OR templates.labels LIKE  CONCAT('%','${name}','%' )	</select>	<select id="front.template.selectTemplateListByIds" parameterType="net.yozo.services.front.template.bean.Template" resultType="net.yozo.services.front.template.bean.Template">		select t.*,c.name as catalogName from t_template t,t_catalog c where status=1 and t.catalogID=c.id		<if test="templateIds!=null and templateIds.size &gt; 0">			and t.id in <foreach item="item" index="index" collection="templateIds" open="(" separator="," close=")">			#{item}		</foreach>		</if>	</select>	<!--首页ppt excel word 最新推荐 最热下载 新品 等数据 -->	<select id="front.template.loadHotTemplateShowIndex" parameterType="net.yozo.services.front.template.bean.Template" resultType="net.yozo.services.front.template.bean.Template">		select p.id,p.name,author,catalogID,createTime,updateTime,publishTime,browseNum,downloadNum,status,score,		price,nowPrice,fileUrl,shrinkUrl,showModel,isTop,isRecommend,source,imgUrl,videoUrl from t_template p		LEFT JOIN t_template_recommend r ON p.id=r.template_id		LEFT JOIN t_catalog t ON p.catalogID = t.id		where status=1  and isTop='y'		<if test="name!=null and name!=''">			and t.code like CONCAT('%','${name}','%' )		</if>		<if test="name =='AE'">			and videoUrl is not null		</if>		<choose>			<when test="orderBy==1">				order by IFNULL(r.sort,0) desc,p.updateTime desc			</when>			<when test="orderBy==2">				order by downloadNum desc			</when>			<when test="orderBy==3">				order by updateTime desc			</when>			<otherwise>				order by updateTime desc			</otherwise>		</choose>		limit 0,#{top}	</select>	<update id="front.template.updateHit" parameterType="net.yozo.services.front.template.bean.Template">		update t_template set browseNum=browseNum+1 where id=#{id}	</update>	<update id="front.template.updateSellCount" parameterType="net.yozo.services.front.template.bean.Template">		update t_template set sellCount = sellCount+1, browseNum=browseNum+1, downloadNum=downloadNum+1 where id=#{id}	</update>	<select id="front.template.getLabelNamesById" parameterType="String" resultType="String">		SELECT NAME FROM t_label WHERE id IN(SELECT DISTINCT l_id FROM t_label_link WHERE t_id=#{id})	</select>		<select id="front.template.selectById" parameterType="string" resultType="net.yozo.services.front.template.bean.Template">	 select * from t_template t where id=#{id}	</select>		<delete id="front.template.deleteById" parameterType="int">		delete from t_template where id=#{id}	</delete>		<delete id="front.template.deleteLabelLinkByTemplateID" parameterType="int">		delete from t_label_link where t_id=#{t_id}	</delete>	<update id="front.template.updateTemplateStatus" parameterType="net.yozo.services.front.template.bean.Template">		update t_template set status=#{status},updateTime=now() where id=#{id}	</update>	<select id="front.template.selectTemplateUploadList" parameterType="net.yozo.services.front.template.bean.Template" resultType="net.yozo.services.front.template.bean.Template">		select p.id,p.catalogID,p.name,p.price,p.nowPrice,p.author,p.isTop,p.isRecommend,p.description,p.downloadNum,p.shareNum,p.score,		p.collectNum,p.browseNum,p.imgUrl,p.shrinkUrl,p.fileUrl,p.videoUrl,p.showModel,p.status,p.createTime,p.updateTime,p.sellCount,p.publishTime,p.comment		from t_template p		LEFT JOIN t_template_recommend r ON p.id=r.template_id		where status IN (-1,0,1,2)		<if test="id!=null and id!=''">			and p.id=#{id}		</if>		<if test="catalogID!=null and catalogID!=''">			and catalogID=#{catalogID}		</if>		<if test="name!=null and name!=''">			and name like concat('%',#{name,jdbcType=VARCHAR},'%')		</if>		<if test="author!=null and author!=''">			and author=#{author}		</if>		<if test="source != 0">			and source=#{source}		</if>		<if test="isTop!=null and isTop!=''">			and isTop=#{isTop}		</if>		<if test="isRecommend!=null and isRecommend!=''">			and isRecommend=#{isRecommend}		</if>		<if test="startDate!=null and startDate!=''">			and createTime &gt;= #{startDate}		</if>		<if test="endDate!=null and endDate!=''">			and createTime &lt;= #{endDate}		</if>		<if test='isFee=="y"'>			and  nowPrice=0  and score=0		</if>		<if test='isFee=="n"'>			and  (nowPrice>0 or isTop="y")		</if>		<if test="queryLabelIDs!=null and queryLabelIDs.size &gt; 0">			and p.id in ( select distinct t_id from t_label_link			where l_id in			<foreach item="item" index="index" collection="queryLabelIDs" open="(" separator="," close=")">				#{item}			</foreach>			)		</if>		<if test="orderBy==1">			order by browseNum desc		</if>		<if test="orderBy==2">			order by publishTime desc		</if>		<if test="orderBy==3">			order by downloadNum desc		</if>		<if test="orderBy==4">			order by IFNULL(r.sort,0) desc,p.updateTime desc		</if>		<if test=" orderBy==null or orderBy==''">			order by p.updateTime desc		</if>		limit #{offset},#{pageSize}	</select>	<select id="front.template.selectTemplateUploadCount" parameterType="net.yozo.services.front.template.bean.Template" resultType="java.lang.Integer">		select count(*) from t_template p where status IN (-1,0,1,2)		<if test="id!=null and id!=''">			and p.id=#{id}		</if>		<if test="catalogID!=null and catalogID!=''">			and catalogID=#{catalogID}		</if>		<if test="author!=null and author!=''">			and author=#{author}		</if>		<if test="name!=null and name!=''">			and name like concat('%',#{name,jdbcType=VARCHAR},'%')		</if>		<if test="source != 0">			and source=#{source}		</if>		<if test="isTop!=null and isTop!=''">			and isTop=#{isTop}		</if>		<if test="isRecommend!=null and isRecommend!=''">			and isRecommend=#{isRecommend}		</if>		<if test="startDate!=null and startDate!=''">			and createTime &gt;= #{startDate}		</if>		<if test="endDate!=null and endDate!=''">			and createTime &lt;= #{endDate}		</if>		<if test='isFee=="y"'>			and  nowPrice=0  and score=0		</if>		<if test='isFee=="n"'>			and  (nowPrice>0 or isTop="y")		</if>		<if test="queryLabelIDs!=null and queryLabelIDs.size &gt; 0">			and p.id in ( select distinct t_id from t_label_link			where l_id in			<foreach item="item" index="index" collection="queryLabelIDs" open="(" separator="," close=")">				#{item}			</foreach>			)		</if>	</select>	<select id="front.template.selectForDelete" parameterType="net.yozo.services.front.template.bean.Template" resultType="net.yozo.services.front.template.bean.Template">		select *		from t_template t where 1=1		<if test="id!=null and id!=''">			and id=#{id}		</if>		<if test="author!=null and author!=''">			and author=#{author}		</if>		<if test="status!=null ">			and status=#{status}		</if>	</select>	<select id="front.template.selectDesignerWorks" parameterType="net.yozo.services.front.template.bean.Template" resultType="net.yozo.services.front.template.bean.Template">		select *		from t_template t where 1=1		<if test="author!=null and author!=''">			and author=#{author}		</if>		<if test="status!=null ">			and status=#{status}		</if>		<if test="orderBy==1">			order by  updateTime desc		</if>		<if test="orderBy==2">			order by browseNum desc		</if>		<if test="orderBy==3">			order by downloadNum desc		</if>		<if test="orderBy==4">			order by IFNULL(r.sort,0) desc,p.updateTime desc		</if>		<if test=" orderBy==null or orderBy==''">			order by publishTime desc		</if>		limit #{offset},#{pageSize}	</select>	<select id="front.template.selectDesignerWorksCount" parameterType="net.yozo.services.front.template.bean.Template" resultType="java.lang.Integer">		select count(*)		from t_template t where 1=1		<if test="author!=null and author!=''">			and author=#{author}		</if>		<if test="status!=null ">			and status=#{status}		</if>	</select>	<select id="front.template.selectUserTemplateCount" parameterType="net.yozo.services.front.template.bean.Template" resultType="java.lang.Integer">		select count(*) from t_template p where status=1		<if test="author!=null and author!=''">			and author=#{author}		</if>	</select>	<select id="front.template.selectRelatedRecommendTempaltes" parameterType="net.yozo.services.front.template.dto.RelatedTemplateQuery" resultType="net.yozo.services.front.template.bean.Template">		<![CDATA[		select t.* from(		SELECT t_id,count(t_id) as sort,1 as flag FROM t_label_link  where t_id <>  #{tempalteId}				and l_id in (SELECT l_id from t_label_link where t_id =  #{tempalteId})				and EXISTS (SELECT id from t_template where id = t_id and status =1)				GROUP BY t_id		UNION		 SELECT template_id as t_id,sort,0 as flag from t_template_recommend where  template_id <>  #{tempalteId}		)as tem LEFT JOIN t_template t on tem.t_id = t.id order by CONCAT(flag,sort) DESC		limit #{start},8		]]>	</select>	<select id="front.template.selectRelatedTempaltesCount" parameterType="net.yozo.services.front.template.dto.RelatedTemplateQuery" resultType="java.lang.Integer">		<![CDATA[        select count(*) from (			SELECT t_id FROM t_label_link  where t_id <>  #{tempalteId}					and l_id in (SELECT l_id from t_label_link where t_id =  #{tempalteId})					 and EXISTS (SELECT id from t_template where id = t_id  and status =1)					 GROUP BY t_id					) as  a		]]>	</select>	<select id="front.template.selectRelatedTempaltes" parameterType="net.yozo.services.front.template.dto.RelatedTemplateQuery" resultType="net.yozo.services.front.template.bean.Template">		<![CDATA[		SELECT tt.* from		(		SELECT t_id,count(t_id) as counts FROM t_label_link  where t_id <> #{tempalteId}		and l_id in (SELECT l_id from t_label_link where t_id = #{tempalteId})		and EXISTS (SELECT id from t_template where id = t_id  and status =1)		GROUP BY t_id		) as tl LEFT JOIN t_template tt on tl.t_id = tt.id ORDER BY counts DESC		limit #{start},8		]]>	</select></mapper>